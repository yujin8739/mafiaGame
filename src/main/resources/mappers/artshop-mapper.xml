<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "Http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="artshopMapper">

    <!-- 일러스트 등록 -->
    <insert id="insertArtwork" parameterType="Shop">
    INSERT INTO USER_ARTWORK (
        ARTID,
        TITLE,
        DESCRIPTION,
        IMAGEPATH,
        SELLERNAME,
        PRICE,
        STATUS,
        UPLOADDATE
    ) VALUES (
        SEQ_ART_ID.NEXTVAL,
        #{title},
        #{description},
        #{imagePath},
        #{sellerName},
        #{price},
        #{status},
        SYSDATE
    )
</insert>

    <!-- 일러스트 전체 조회 -->
    <select id="selectAllArtworks" resultType="Shop">
        SELECT * 
        FROM USER_ARTWORK
        ORDER BY ARTID DESC
    </select>
    
    <!-- 상세 페이지 조회용  -->
    <select id="selectArtworkById" resultType="Shop" parameterType="int">
    SELECT * 
    FROM USER_ARTWORK
    WHERE ARTID = #{artId}
	</select>
	
	<!-- 수정 구문 -->
	<update id="updateArt" parameterType="com.mafia.game.shop.model.vo.Shop">
    UPDATE USER_ARTWORK
    SET
        TITLE = #{title},
        DESCRIPTION = #{description},
        IMAGEPATH = #{imagePath},
        PRICE = #{price}
    WHERE ARTID = #{artId}
	</update>
	
	<!-- 삭제 구문 -->
	<delete id="deleteArt" parameterType="int">
    DELETE FROM USER_ARTWORK WHERE ARTID = #{artId}
	</delete>
	

	<!-- 구매 및 판매완료 구문 -->
	<update id="purchaseArt" parameterType="map">
	    UPDATE USER_ARTWORK
	    SET 
	        buyerName = #{buyerName},
	        status = '판매완료'
	    WHERE artId = #{artId}
	</update>
	
		<!-- 판매중만 조회 -->
	<select id="selectSellingList" resultType="Shop">
	  SELECT * FROM USER_ARTWORK WHERE STATUS = '판매중'
	</select>
	
	<!-- 구매자 이름 기준 조회 -->
	<select id="selectMyItems" parameterType="String" resultType="Shop">
	  SELECT * FROM USER_ARTWORK WHERE BUYERNAME = #{buyerName}
	</select>
	
	<!-- 구매한 작품 리스트 조회 -->
	<select id="selectMyPurchaseList" parameterType="string" resultType="com.mafia.game.shop.model.vo.Shop">
	    SELECT * FROM USER_ARTWORK
	    WHERE BUYERNAME = #{buyerName}
	</select>
	
	<!-- 구매 처리 (구매자 이름 업데이트 + 상태 변경) -->
	<update id="purchaseBuyArt" parameterType="map">
	    UPDATE USER_ARTWORK
	    SET BUYERNAME = #{buyerName}, STATUS = '판매완료'
	    WHERE ARTID = #{artId}
	</update>
	
</mapper>
