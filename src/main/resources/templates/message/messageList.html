<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>μ½μ§€ν•¨ - GodFather 0805</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/common/header.css}" />
    <link rel="stylesheet" th:href="@{/css/common/footer.css}" />
    <link rel="stylesheet" th:href="@{/css/member/mypage.css}" />
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" th:href="@{/css/message/message.css}" />
    <link rel="stylesheet" th:href="@{/css/friend/friendList.css}" />
    <script th:src="@{/js/message/messageList.js}"></script>
</head>
<body>
    <!-- λ©”μ‹μ§€ ν‘μ‹ -->
    <div th:if="${successMsg}">
        <script th:inline="javascript">
            alert(/*[[${successMsg}]]*/ 'λ©”μ‹μ§€');
        </script>
    </div>

    <!-- ν—¤λ” -->
    <div th:replace="~{common/header :: header}"></div>

    <!-- μ½μ§€ν•¨ μ»¨ν…μ΄λ„ -->
    <div class="message-container">
        <h1 class="mypage-title">π“¬ μ½μ§€ν•¨</h1>

        <!-- νƒ­ λ©”λ‰΄ -->
        <div class="message-tabs">
            <button class="tab-button" th:classappend="${messageType == 'received'} ? 'active' : ''" 
                    onclick="location.href='/message/inbox'">
                λ°›μ€νΈμ§€ν•¨
                <span th:if="${unreadCount > 0}" class="unread-badge" th:text="${unreadCount}">0</span>
            </button>
            <button class="tab-button" th:classappend="${messageType == 'sent'} ? 'active' : ''" 
                    onclick="location.href='/message/outbox'">
                λ³΄λ‚ΈνΈμ§€ν•¨
            </button>
        </div>

        <!-- μ½μ§€ λ©λ΅ -->
        <div class="profile-section" id="message-list">
            <!-- μ½μ§€κ°€ μμ„ λ• -->
			 <div th:if="${messages != null and !#lists.isEmpty(messages)}">
			    <table class="message-table">
			        <thead>
			            <tr>
			                <th>λ²νΈ</th>
			                <th th:if="${messageType == 'received'}">λ³΄λ‚Έμ‚¬λ</th>
			                <th th:if="${messageType == 'sent'}">λ°›λ”μ‚¬λ</th>
			                <th>μ λ©</th>
			                <th>λ‚ μ§</th>
			                <th th:if="${messageType == 'received'}">μ½μμƒνƒ</th>
			                <th>κ΄€λ¦¬</th>
			            </tr>
			        </thead>
			        <tbody>
			            <!--  μ½μ μƒνƒ ν‘μ‹ -->
			            <tr th:each="message, iterStat : ${messages}"
			                th:classappend="${message.readYn == 'N' and messageType == 'received'} ? 'unread-row' : 'read-row'">
			                
			               	<td th:text="${(currentPage - 1) * 5 + iterStat.count}">1</td>
			                
			                <!-- λ³΄λ‚Έμ‚¬λ/λ°›λ”μ‚¬λ -->
			                <td th:if="${messageType == 'received'}" 
			                    th:text="${message.senderNickName != null ? message.senderNickName : message.senderUserName}">
			                    λ³΄λ‚Έμ‚¬λ
			                </td>
			                <td th:if="${messageType == 'sent'}" 
			                    th:text="${message.receiverNickName != null ? message.receiverNickName : message.receiverUserName}">
			                    λ°›λ”μ‚¬λ
			                </td>
			                
			                <!--  μ λ© μ…€ -->
			                <td class="message-title" 
			                    th:classappend="${message.readYn == 'N' and messageType == 'received'} ? 'unread' : 'read'">
			                    
			                    <span th:data-message-id="${message.privateMsgNo}" 
			                          onclick="goToDetail(this.getAttribute('data-message-id'))"
			                          style="cursor: pointer; display: block; width: 100%;">
			                        
			                        <!-- μ λ© ν…μ¤νΈ -->
			                        <span th:text="${message.title}">μ½μ§€ μ λ©</span>
			                        
			                        <!-- μƒ λ©”μ‹μ§€ λ°°μ§€ κ°κ±΄ -->
			                        <span th:if="${message.readYn == 'N' and messageType == 'received'}" 
			                              class="new-message-badge">NEW</span>
			                    </span>
			                </td>
			                
			                <!-- λ‚ μ§ -->
			                <td th:text="${#dates.format(message.sendDate, 'MM-dd HH:mm')}">01-09 14:30</td>
			                
			                <!--  μ½μ μƒνƒ ν‘μ‹ -->
			                <td th:if="${messageType == 'received'}">
			                    <span th:if="${message.readYn == 'Y'}" class="read-status read">μ½μ</span>
			                    <span th:if="${message.readYn == 'N'}" class="read-status unread">μ•μ½μ</span>
			                </td>
			                
			                <!-- μ‚­μ  λ²„νΌ -->
			                <td>
			                    <button class="delete-btn" 
			                            th:data-message-id="${message.privateMsgNo}"
			                            th:data-delete-type="${messageType == 'received' ? 'receiver' : 'sender'}"
			                            onclick="deleteMessage(this.getAttribute('data-message-id'), this.getAttribute('data-delete-type'))">
			                        μ‚­μ 
			                    </button>
			                </td>
			            </tr>
			        </tbody>
			    </table>
			    
			    <div class="pagination" th:if="${totalPages > 1}">
                    <!-- μ²μ νμ΄μ§€ -->
                    <a th:if="${currentPage > 1}" 
                       th:href="@{${messageType == 'received' ? '/message/inbox' : '/message/outbox'}(page=1)}">μ²μ</a>
                    <span th:if="${currentPage == 1}" class="disabled">μ²μ</span>
                    
                    <!-- μ΄μ „ νμ΄μ§€ -->
                    <a th:if="${hasPrevious}" 
                       th:href="@{${messageType == 'received' ? '/message/inbox' : '/message/outbox'}(page=${currentPage - 1})}">μ΄μ „</a>
                    <span th:if="${!hasPrevious}" class="disabled">μ΄μ „</span>
                    
                    <!-- νμ΄μ§€ λ²νΈλ“¤ -->
                    <span th:each="i : ${#numbers.sequence(T(java.lang.Math).max(1, currentPage - 2), T(java.lang.Math).min(totalPages, currentPage + 2))}">
                        <a th:if="${i != currentPage}" 
                           th:href="@{${messageType == 'received' ? '/message/inbox' : '/message/outbox'}(page=${i})}" 
                           th:text="${i}">1</a>
                        <span th:if="${i == currentPage}" class="current" th:text="${i}">1</span>
                    </span>
                    
                    <!-- λ‹¤μ νμ΄μ§€ -->
                    <a th:if="${hasNext}" 
                       th:href="@{${messageType == 'received' ? '/message/inbox' : '/message/outbox'}(page=${currentPage + 1})}">λ‹¤μ</a>
                    <span th:if="${!hasNext}" class="disabled">λ‹¤μ</span>
                    
                    <!-- λ§μ§€λ§‰ νμ΄μ§€ -->
                    <a th:if="${currentPage < totalPages}" 
                       th:href="@{${messageType == 'received' ? '/message/inbox' : '/message/outbox'}(page=${totalPages})}">λ</a>
                    <span th:if="${currentPage == totalPages}" class="disabled">λ</span>
                    
                    <!-- νμ΄μ§€ μ •λ³΄ -->
                    <span class="pagination-info" 
                          th:text="${currentPage + ' / ' + totalPages + ' νμ΄μ§€ (μ΄ ' + totalMessages + 'κ°)'}">
                        1 / 5 νμ΄μ§€ (μ΄ 23κ°)
                    </span>
                </div>						    
			</div>
            
            <!-- μ½μ§€κ°€ μ—†μ„ λ• -->
            <div th:if="${messages == null or #lists.isEmpty(messages)}" class="no-messages">
                <p th:if="${messageType == 'received'}">λ°›μ€ μ½μ§€κ°€ μ—†μµλ‹λ‹¤.</p>
                <p th:if="${messageType == 'sent'}">λ³΄λ‚Έ μ½μ§€κ°€ μ—†μµλ‹λ‹¤.</p>
            </div>
        </div>

        <!-- μ•΅μ… λ²„νΌλ“¤ -->
        <div class="action-buttons">
            <a href="/message/write" class="mypage-btn primary">μ½μ§€ μ“°κΈ°</a>
            <a href="/mypage" class="mypage-btn">λ§μ΄νμ΄μ§€λ΅</a>
            <button onclick="location.reload()" class="mypage-btn">μƒλ΅κ³ μΉ¨</button>
        </div>
    </div>

    <!-- ν‘Έν„° -->
    <div th:replace="~{common/footer :: footer}"></div>

	
</body>
</html>