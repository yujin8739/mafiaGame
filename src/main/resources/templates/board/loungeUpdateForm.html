<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>게시글 수정</title>

<!-- Bootstrap -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css" />
<!-- font-awesome -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- Quill 에디터 스타일 -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
	rel="stylesheet" />
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- 공통 스타일 -->
<link rel="stylesheet" th:href="@{/css/common/header.css}" />
<link rel="stylesheet" th:href="@{/css/common/footer.css}" />
<link rel="stylesheet" th:href="@{/css/friend/friendList.css}" />
<link rel="stylesheet" th:href="@{/css/board/loungeUpdateForm.css}" />

</head>
<body>

	<!-- 헤더 -->
	<div th:replace="~{common/header :: header}"></div>

	<div class="board-wrapper">
		<div class="card">
			<div class="card-header">게시글 수정</div>
			<div class="card-body">
				<form th:action="@{/board/lounge/update}" method="post"
					enctype="multipart/form-data" id="loungeBoardForm">
					<input type="hidden" name="boardNo" th:value="${board.boardNo}" />
					<input type="hidden" name="detail" id="detailInput" />

					<div class="form-group">
						<label for="category">카테고리</label> <select name="typeName"
							id="category" required>
							<option value="">-- 선택하세요 --</option>
							<option value="자유">자유</option>
							<option value="플레이">플레이</option>
							<option value="직업">직업</option>
						</select>
					</div>

					<!-- 팀 및 직업 선택 영역 -->
					<div id="team-role-section" style="display: none;">
						<div class="form-group">
							<label for="team">팀 선택</label> <select id="team-select"
								style="width: 100%; height: 48px; border-radius: 6px; border: 1px solid #555; background-color: #2a2a2a; color: #fff;">
								<option value="">-- 팀 선택 --</option>
								<option value="mafia">팀 마피아</option>
								<option value="citizen">팀 시민</option>
								<option value="third">팀 제3세력</option>
							</select>
						</div>

						<div class="form-group" id="role-group" style="display: none;">
							<label for="typeNo">직업 선택</label> <select id="role-select"
								style="width: 100%; height: 48px; border-radius: 6px; border: 1px solid #555; background-color: #2a2a2a; color: #fff;">
								<!-- JS로 채움 -->
							</select>
						</div>
					</div>

					<div class="form-group">
						<label for="title">제목</label> <input type="text"
							class="form-control" id="title" name="title"
							th:value="${board.title}" required />
					</div>

					<div class="form-group">
						<label for="editor">내용</label>
						<div id="editor"></div>
					</div>

					<div class="form-group">
						<label for="file">첨부파일</label> <input type="file"
							class="form-control-file" id="file" name="uploadFile"
							accept="image/*" />

						<div class="mt-2" id="current-file-info"
							th:if="${board.fileList[0].fileNo != 0}">
							현재 파일: <span th:text="${board.fileList[0].originName}"></span>
							<button type="button" class="btn btn-sm btn-danger ml-2"
								id="deleteFileBtn">삭제</button>
						</div>

						<input type="hidden" th:value="${board.fileList[0].changeName}"
							name="changeName">
						<!-- deleteFile hidden input은 JS로 동적으로 생성됨 -->
					</div>

					<div class="text-right mt-4">
						<button type="submit" class="btn btn-custom btn-update">수정하기</button>
						<a href="javascript:history.back()"
							class="btn btn-custom btn-cancel">취소</a>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- 푸터 -->
	<div th:replace="~{common/footer :: footer}"></div>

	<!-- Quill -->
	<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
	<script th:inline="javascript">
		const detail = /*[[${board.detail}]]*/'';
		const typeNameOfBoard = /*[[${board.typeName}]]*/ '';
	</script>
	<script th:src="@{/js/board/quillForUpdate.js}"></script>
	<script th:src="@{/js/board/jobCategory.js}"></script>
	<script th:src="@{/js/board/loungeUpdateForm.js}"></script>
</body>
</html>
