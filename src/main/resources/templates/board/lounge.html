<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>자유게시판</title>

  <!-- Bootstrap 4.5.2 + jQuery -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- 공통 CSS -->
  <link rel="stylesheet" th:href="@{/css/common/header.css}" />
  <link rel="stylesheet" th:href="@{/css/common/footer.css}" />
  <link rel="stylesheet" th:href="@{/css/friend/friendList.css}" />
  <link rel="stylesheet" th:href="@{/css/board/lounge.css}" />
  
  <!-- HEAD 부분에 Cinzel 폰트 추가 -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet" />
  
</head>
<body>

  <div th:replace="common/header :: header"></div>

  <div class="board-wrapper">
    <div class="main-tabs mb-4" th:object="${filterMap}">
      <a th:href="@{/board/lounge}" th:class="*{typeName == null || typeName == '' || 
      											typeName == '자유' || typeName == '플레이' ||
      											typeClass == '3' ? 'active' : ''}">라운지</a>
      <a th:href="@{/board/gallery}">갤러리</a>
      <a th:href="@{/board/video}">하이라이트 영상</a>
    </div>

    <div class="sub-tabs" th:object="${filterMap}">
      <a th:href="@{/board/lounge}" th:class="*{typeName == null || typeName == '' ? 'active' : ''}">전체</a>
      <a th:href="@{/board/lounge(typeName='자유')}" th:class="*{typeName == '자유' ? 'active' : ''}">자유</a>
      <a th:href="@{/board/lounge(typeName='플레이')}" th:class="*{typeName == '플레이' ? 'active' : ''}">플레이</a>
      <a th:href="@{/board/lounge(typeName='직업')}" th:class="*{typeClass != null AND typeClass == '3' ? 'active' : ''}">직업</a>
    </div>

    <!-- 직업 탭 선택 시 표시될 팀 탭 -->
    <div id="teamTabs" class="team-tabs" th:object="${filterMap}">
      <a th:href="@{/board/lounge(typeName='직업')}" class="team-tab" data-team="all"
      th:classappend="*{typeName == '직업' ? ' active' : ''}">전체</a>
      <a href="#" class="team-tab" data-team="mafia" id="team-mafia">팀 마피아</a>
      <a href="#" class="team-tab" data-team="citizen" id="team-citizen">팀 시민</a>
      <a href="#" class="team-tab" data-team="third" id="team-third">팀 제3세력</a>
    </div>

    <!-- 각 팀별 직업 탭 -->
    <div id="roleTabs-mafia" class="role-tabs" th:object="${filterMap}">
      <a th:href="@{/board/lounge(typeName='마피아')}" data-job="mafia" id="mafia"
      th:class="*{typeName == '마피아' ? 'active' : ''}">마피아</a>
      <a th:href="@{/board/lounge(typeName='스파이')}" data-job="spy" id="spy"
      th:class="*{typeName == '스파이' ? 'active' : ''}">스파이</a>
    </div>

    <div id="roleTabs-citizen" class="role-tabs" th:object="${filterMap}">
      <a th:href="@{/board/lounge(typeName ='경찰')}" data-job="police" id="police"
      th:class="*{typeName == '경찰' ? 'active' : ''}">경찰</a>
      <a th:href="@{/board/lounge(typeName='의사')}" data-job="doctor" id="doctor"
      th:class="*{typeName == '의사' ? 'active' : ''}">의사</a>
      <a th:href="@{/board/lounge(typeName='정치인')}" data-job="politician" id="politician"
      th:class="*{typeName == '정치인' ? 'active' : ''}">정치인</a>
      <a th:href="@{/board/lounge(typeName='연인')}" data-job="marriage" id="marriage"
      th:class="*{typeName == '연인' ? 'active' : ''}">연인</a>
      <a th:href="@{/board/lounge(typeName='군인')}" data-job="soldier" id="soldier"
      th:class="*{typeName == '군인' ? 'active' : ''}">군인</a>
      <a th:href="@{/board/lounge(typeName='영매사')}" data-job="spiritualist" id="spiritualist"
      th:class="*{typeName == '영매사' ? 'active' : ''}">영매사</a>
    </div>

    <div id="roleTabs-third" class="role-tabs" th:object="${filterMap}">
      <a th:href="@{/board/lounge(typeName='훼방꾼')}" data-job="disruptor" id="disruptor"
      th:class="*{typeName == '훼방꾼' ? 'active' : ''}">훼방꾼</a>
      <a th:href="@{/board/lounge(typeName='도굴꾼')}" data-job="robber" id="robber"
      th:class="*{typeName == '도굴꾼' ? 'active' : ''}">도굴꾼</a>
      <a th:href="@{/board/lounge(typeName='네크로맨서')}" data-job="necromancer" id="necromancer"
      th:class="*{typeName == '네크로맨서' ? 'active' : ''}">네크로맨서</a>
    </div>

    
	
    
	
	<!-- 검색창 -->
    <form class="search-bar" method="get" th:action="@{/board/lounge}" th:object="${filterMap}">
      <select name="condition">
        <option value="title" th:selected="*{condition == 'title'}">제목</option>
        <option value="writer" th:selected="*{condition == 'writer'}">작성자</option>
        <option value="content" th:selected="*{condition == 'content'}">내용</option>
      </select>
      <input type="text" name="keyword" placeholder="검색어 입력" th:value="*{keyword}">
      <input type="hidden" name="typeName" th:value="*{typeName}">
      <button type="submit">검색</button>
    </form>
    
	<div style="display: flex; justify-content: flex-end; margin-bottom: 12px;">
	  <button class="write-btn" onclick="location.href='/board/lounge/write'">글쓰기</button>
	</div>
	
	<div class="top5-likes mb-4" th:if="${!#lists.isEmpty(topLikedList)}">
	  <h3>🔥 MOST LIKED</h3>
	  <div class="top5-cards">
	    <a th:each="post : ${topLikedList}"
	       th:href="@{/board/lounge/detail/{boardNo}(boardNo=${post.boardNo})}"
	       class="top5-card-link">
	      <div class="top5-card">
	        <div class="top5-title">
	          <span th:text="${post.title}"></span>
	          <span th:if="${post.replyCount > 0}" class="top5-comment-count">
	            [<span th:text="${post.replyCount}"></span>]
	          </span>
	          <span th:if="${post.hasFile == 'Y'}" style="margin-left: 4px;padding-left: 0">📎</span>
	        </div>
	        <div class="top5-info">
	          <img th:if="${post.profileUrl != null}" th:src="${post.profileUrl}" alt="뱃지" class="top5-badge" />
	          <span class="top5-nickname" th:text="${post.nickName}"></span>
	          <span class="top5-likes-count"><span th:text="${post.likeCount}"></span></span>
	          <span class="top5-date" th:text="${post.createDate}"></span>
	        </div>
	      </div>
	    </a>
	  </div>
	</div>
	
	
	<table class="board-table">
	  <thead>
	    <tr>
	      <th></th>
	      <th style="text-align: left;">제목</th>
	      <th style="text-align: left;">작성자</th>
	      <th style="text-align: left;">날짜</th>
	      <th style="text-align: left;">조회수</th>
	    </tr>
	  </thead>
	 
	  
	  <tbody>
	    <!-- ✅ 일반 게시글 리스트 -->
	    <tr th:if="${#lists.isEmpty(boardList)}">
	      <td colspan="5">조회된 게시물이 없습니다</td>
	    </tr>
	    <tr th:each="b : ${boardList}">
	      <td>
	        <span class="board-tag" th:text="${b.typeName}"></span>
	      </td>
	      <td style="text-align: left;">
	        <a th:href="@{/board/lounge/detail/{boardNo}(boardNo=${b.boardNo})}"
	           class="post-title"
	           th:utext="${b.title + (b.replyCount > 0 ? ' <span class=''comment-count''>[' + b.replyCount + ']</span>' : '')}">
	        </a>
	        <span th:if="${b.isNew}" class="new-label">N</span>
	        <span th:if="${b.hasFile == 'Y'}" style="margin-left: 4px;padding-left: 0">📎</span>
	      </td>
	      <td style="text-align: left;">
	        <div style="display: flex; align-items: center; gap: 8px;">
	          <img th:if="${b.profileUrl != null}" th:src="${b.profileUrl}" class="badge-icon" alt="뱃지 이미지" />
	          <span class="nickname" th:text="${b.nickName}"></span>
	        </div>
	      </td>
	      <td style="text-align: left;" th:text="${b.createDate}"></td>
	      <td style="text-align: left;" th:text="${b.viewCount}"></td>
	    </tr>
	  </tbody>
	</table>
    <!-- 페이지네이션 -->
    <ul class="pagination" th:if="${pi.endPage != 0}" th:object="${filterMap}">
      <li th:each="i : ${#numbers.sequence(pi.startPage,pi.endPage)}" th:classappend="${pi.currentPage == i ? ' active' : ''}" class="page-item">
        <a class="page-link" th:href="@{/board/lounge(currentPage=${i},typeName=*{typeName},condition=*{condition},keyword=*{keyword})}" th:text="${i}"></a>
      </li>
    </ul>
  </div>

  <div th:replace="common/footer :: footer"></div>

  <script th:inline="javascript">
  	const typeClassOfFilterMap = /*[[${filterMap.typeClass}]]*/ 0;
  </script>
  <script th:src="@{/js/board/lounge.js}" th:inline="javascript"></script>
  
</body>
</html>
