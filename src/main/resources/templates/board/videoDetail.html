<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title th:text="'영상 | ' + ${video.title}">영상 상세</title>

<!-- Bootstrap + jQuery -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css" />
<script
	src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

<!-- Font Awesome -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<!-- HLS.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<!-- 공통 CSS -->
<link rel="stylesheet" th:href="@{/css/common/header.css}" />
<link rel="stylesheet" th:href="@{/css/common/footer.css}" />
<link rel="stylesheet" th:href="@{/css/friend/friendList.css}" />
<link rel="stylesheet" th:href="@{/css/board/videoDetail.css}" />

</head>
<body>

	<!-- 헤더 -->
	<div th:replace="common/header :: header"></div>

	<div class="video-wrapper">
		<div class="video-card">

			<div class="video-title" th:utext="|<h2>${video.title}</h2>|">영상
				제목</div>

			<div class="video-body">
				<div class="video-meta">
					<img th:if="${video.profileUrl}" th:src="${video.profileUrl}"
						alt="프로필" /> <span th:text="${video.nickName}">닉네임</span> <span
						th:text="${video.createDate}">2025.07.15</span> <span>조회수 <span
						th:text="${video.viewCount}">123</span></span> <span>❤ <span
						th:text="${video.likeCount}">12</span></span>
				</div>

				<div class="video-player">
					<video id="video" controls></video>
				</div>

				<div class="video-description" th:utext="${video.detail}">영상에
					대한 설명입니다. 재미있었던 하이라이트 장면을 소개합니다.</div>

				<!-- ✅ 게시글 좋아요/싫어요 버튼: 본문 바로 아래에 위치 -->
				<div
					class="post-like-dislike d-flex justify-content-center align-items-center"
					style="gap: 15px; margin: 30px 0;">
					<button id="btnLike" type="button"
						class="btn btn-outline-danger d-flex align-items-center"
						style="gap: 6px;">
						<i class="fas fa-heart"></i> 좋아요 <span id="likeCount"
							th:text="${video.likeCount}">0</span>
					</button>
					<button id="btnDislike" type="button"
						class="btn btn-outline-primary d-flex align-items-center"
						style="gap: 6px;">
						<i class="fas fa-thumbs-down"></i> 싫어요 <span id="dislikeCount"
							th:text="${video.dislikeCount}">0</span>
					</button>
				</div>





				<div class="btn-group-custom">
					<a onclick="history.go(-1)" class="btn btn-custom btn-list">목록으로</a>
					<th:block th:if="${loginUser.userName == video.userName}">
						<a
							th:href="@{/board/video/update/{boardNo}(boardNo=${video.boardNo})}"
							class="btn btn-custom btn-update">수정</a>
					</th:block>
					<th:block th:if="${loginUser.userName == video.userName}">
						<form
							th:action="@{/board/video/delete/{boardNo}(boardNo=${video.boardNo})}"
							method="POST">
							<button class="btn btn-custom btn-delete"
								onclick="return confirm('정말로 삭제하시겠습니까?')">삭제</button>
						</form>
					</th:block>
				</div>

				<!-- 댓글 시작 전 -->

				<!-- 댓글 영역 -->
				<div class="comments-section">
					<hr />
					<!-- ✅ BEST 댓글 영역 -->
					<div class="best-comments-section" style="margin-top: 40px;">
						<h6>🔥 베스트 댓글</h6>
						<div id="bestCommentList" class="comment-list"></div>
						<hr />
					</div>


					<h6>💬 댓글</h6>

					<!-- 댓글 목록 -->
					<div id="commentList" class="comment-list">
						<!-- 비동기로 불러온 댓글이 여기에 삽입될 예정 -->
					</div>

					<!-- 댓글 작성 폼 -->
					<div class="comment-form mt-3">
						<textarea class="form-control" id="commentContent" rows="3"
							placeholder="댓글을 입력하세요..."></textarea>
						<!-- 이미지 파일 업로드 추가 -->
						<div class="mt-2">
							<input type="file" id="commentImage" accept="image/*"
								class="form-control-file text-light">
						</div>
						<img id="previewImage"
							style="max-width: 100px; margin-top: 10px; display: none;" />

						<div class="text-right mt-2">
							<button class="btn btn-primary btn-sm" id="submitComment">등록</button>
						</div>

					</div>
				</div>
			</div>

		</div>
	</div>

	<!-- 푸터 -->
	<div th:replace="common/footer :: footer"></div>
	
	<script th:inline="javascript">
		const boardNo = /*[[${video.boardNo}]]*/ 0;
		const userName = /*[[${loginUser.userName}]]*/ '';
	</script>
	<script th:src="@{/js/board/comment.js}" th:inline="javascript"></script>
	<script th:src="@{/js/board/postLike.js}" th:inline="javascript"></script>
	
	<!-- HLS.js video 재생 -->
	<script th:inline="javascript">
		$(function() {
			const video = document.getElementById('video');
			const videoSrc = '/godDaddy_uploadVideo/hls/'
					+ /*[[${#strings.replace(video.changeName, '.mp4', '.m3u8')}]]*/'';

			if (Hls.isSupported()) {
				const hls = new Hls();
				hls.loadSource(videoSrc);
				hls.attachMedia(video);
			} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
				video.src = videoSrc;
			}

		});
	</script>
</body>
</html>
