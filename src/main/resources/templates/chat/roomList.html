
<div th:fragment="roomListFragment" style="flex: 2;">
    <div class="game-room-list-container">
        <!-- í—¤ë” -->
        <div class="room-list-header">
            <h2>ê²Œì„ë°© ëª©ë¡</h2>
        </div>

        <!-- ê²Œì„ë°© ëª©ë¡ í…Œì´ë¸” -->
        <div class="room-table-section">
            <table class="room-table">
                <thead>
                    <tr>
                        <th>ë°© ë²ˆí˜¸</th>
                        <th>ë°© ì œëª©</th>
                        <th>ì¸ì›</th>
                        <th>ë°© ì¢…ë¥˜</th>
                        <th>í˜„ì¬ìƒíƒœ</th>
                        <th>ì…ì¥</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ë°©ì´ ìˆì„ ë•Œ -->
                    <tr th:each="room : ${rooms}">
                        <td th:text="${room.roomNo}">1</td>
                        <td class="room-title">
                            <span th:text="${room.roomName}">ê²Œì„ë°© ì´ë¦„</span>
                            <span th:if="${room.password != null and !#strings.isEmpty(room.password)}" class="lock-icon">ğŸ”’</span>
                        </td>
                        <td class="room-count">
						    <span class="current-count" th:text="${room.currentUserCount}">0</span>						 
						    <span class="max-count" th:text="${room.headCount}">12</span>
						</td>
                        <td>
                            <span class="room-type" th:text="${room.type}" 
                                  th:classappend="${room.type == 'ë­í¬' ? ' rank' : (room.type == 'ì¹œì„ ' ? ' friendly' : ' normal')}">ì¼ë°˜</span>
                        </td>
                        <td>
                            <span class="room-status waiting">ëŒ€ê¸°ì¤‘</span>
                        </td>
						<td>
						    <button class="enter-btn" 
						            onclick="enterRoom(room.roomNo, room.password)">
						        ì…ì¥
						    </button>
						</td>
                    </tr>
                    
                    <!-- ë°©ì´ ì—†ì„ ë•Œ -->
                    <tr th:if="${rooms == null or #lists.isEmpty(rooms)}">
                        <td colspan="6" class="no-rooms">
                            <div class="empty-message">
                                <div>í˜„ì¬ ìƒì„±ëœ ê²Œì„ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
<div id="passwordModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
            <span class="close" onclick="closePasswordModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>ì´ ë°©ì€ ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
            <input type="password" id="roomPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <div id="passwordError" class="error-message" style="display: none;">
                ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </div>
        </div>
        <div class="modal-buttons">
            <button class="enter-btn" onclick="confirmEnterRoom()">ì…ì¥</button>
            <button class="cancel-btn" onclick="closePasswordModal()">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<script>
let selectedRoomNo = null;

// ë°© ì…ì¥ í•¨ìˆ˜
function enterRoom(roomNo, password) {
    selectedRoomNo = roomNo;
    
    if (password && password.trim() !== '') {
        // ë¹„ë°€ë²ˆí˜¸ê°€ ìˆëŠ” ë°©
        document.getElementById('passwordModal').style.display = 'flex';
        document.getElementById('roomPassword').focus();
    } else {
        // ë¹„ë°€ë²ˆí˜¸ê°€ ì—†ëŠ” ë°©
    	window.location.href = '/room/' + roomNo + "/00000";
    }
}

// ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í›„ ì…ì¥
function confirmEnterRoom() {
    const inputPassword = document.getElementById('roomPassword').value;
    
    if (!inputPassword) {
        document.getElementById('passwordError').textContent = 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        document.getElementById('passwordError').style.display = 'block';
        return;
    }
    
    // ì„œë²„ë¡œ ì´ë™ (ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ì€ ì„œë²„ì—ì„œ)
    window.location.href = '/room/' + selectedRoomNo + '/' + encodeURIComponent(inputPassword);
}

// ëª¨ë‹¬ ë‹«ê¸°
function closePasswordModal() {
    document.getElementById('passwordModal').style.display = 'none';
    document.getElementById('roomPassword').value = '';
    document.getElementById('passwordError').style.display = 'none';
    selectedRoomNo = null;
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
window.onclick = function(event) {
    const modal = document.getElementById('passwordModal');
    if (event.target === modal) {
        closePasswordModal();
    }
}

// ì—”í„°í‚¤ë¡œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('roomPassword');
    if (passwordInput) {
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmEnterRoom();
            }
        });
    }
});
</script>